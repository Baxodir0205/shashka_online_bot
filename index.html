<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shashka AI - Professional</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { background: #1a252f; font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: white; }
        .game-container { width: 100%; max-width: 400px; padding: 15px; }
        .players-mini { display: flex; justify-content: space-between; margin-bottom: 20px; background: #2c3e50; padding: 12px; border-radius: 15px; border: 1px solid #3e4f5f; }
        .p-card { display: flex; align-items: center; gap: 10px; }
        .p-info { display: flex; flex-direction: column; }
        .p-name { font-weight: bold; font-size: 14px; }
        .p-rank { font-size: 12px; color: #f1c40f; }
        .vs-badge { align-self: center; background: #e74c3c; padding: 2px 8px; border-radius: 5px; font-size: 12px; font-weight: bold; }
        .board-wrapper { background: #3e2723; padding: 8px; border-radius: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .board { display: grid; grid-template-columns: repeat(8, 1fr); aspect-ratio: 1/1; border: 2px solid #2b1d1a; }
        .cell { display: flex; align-items: center; justify-content: center; font-size: 30px; position: relative; width: 100%; height: 100%; }
        .light { background: #d7b899; }
        .dark { background: #795548; }
        .piece { width: 80%; height: 80%; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; transition: 0.2s; }
        .white { background: #ecf0f1; box-shadow: 0 4px #bdc3c7; color: #7f8c8d; }
        .black { background: #2c3e50; box-shadow: 0 4px #1a252f; color: #ecf0f1; }
        .king::after { content: 'ðŸ‘‘'; font-size: 16px; position: absolute; top: 20%; }
        .selected { transform: scale(1.1); box-shadow: 0 0 15px #f1c40f; z-index: 5; }
        .hint { width: 12px; height: 12px; background: rgba(46, 204, 113, 0.7); border-radius: 50%; cursor: pointer; }
        .status-bar { margin-top: 20px; text-align: center; background: #2c3e50; padding: 12px; border-radius: 25px; color: #f1c40f; font-weight: bold; }
        .exit-btn { margin-top: 15px; width: 100%; padding: 12px; border: none; border-radius: 12px; background: #c0392b; color: white; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="game-container">
    <div class="players-mini">
        <div class="p-card">
            <span style="font-size: 24px;">ðŸ‘¤</span>
            <div class="p-info"><span class="p-name">Siz</span><span class="p-rank">â˜… 1200</span></div>
        </div>
        <div class="vs-badge">VS</div>
        <div class="p-card">
            <div class="p-info" style="text-align: right;"><span class="p-name">AI Bot</span><span class="p-rank">Level 3</span></div>
            <span style="font-size: 24px;">ðŸ¤–</span>
        </div>
    </div>

    <div class="board-wrapper">
        <div id="board" class="board"></div>
    </div>

    <div id="status" class="status-bar">âšª Sizning navbatingiz</div>
    <button class="exit-btn" onclick="exitGame()">O'yindan chiqish</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let board = [
        [0,2,0,2,0,2,0,2], [2,0,2,0,2,0,2,0], [0,2,0,2,0,2,0,2],
        [0,0,0,0,0,0,0,0], [0,0,0,0,0,0,0,0],
        [1,0,1,0,1,0,1,0], [0,1,0,1,0,1,0,1], [1,0,1,0,1,0,1,0]
    ];

    let currentPlayer = 1;
    let selected = null;
    let moves = [];

    function render() {
        const b = document.getElementById('board');
        b.innerHTML = '';
        for(let r=0; r<8; r++) {
            for(let c=0; c<8; c++) {
                const cell = document.createElement('div');
                cell.className = `cell ${(r+c)%2===0 ? 'light' : 'dark'}`;

                if(board[r][c] > 0) {
                    const p = document.createElement('div');
                    p.className = `piece ${board[r][c]%2===1 ? 'white' : 'black'} ${board[r][c]>2 ? 'king' : ''}`;
                    if(selected && selected.r === r && selected.c === c) p.classList.add('selected');
                    p.onclick = () => selectPiece(r, c);
                    cell.appendChild(p);
                }

                let move = moves.find(m => m.tr === r && m.tc === c);
                if(move) {
                    const h = document.createElement('div');
                    h.className = 'hint';
                    h.onclick = () => doMove(move);
                    cell.appendChild(h);
                }
                b.appendChild(cell);
            }
        }
    }

    function selectPiece(r, c) {
        if(currentPlayer !== 1 || (board[r][c] !== 1 && board[r][c] !== 3)) return;
        selected = {r, c};
        moves = getValidMoves(r, c, board);
        render();
    }

    function getValidMoves(r, c, curBoard) {
        let p = curBoard[r][c];
        let v_moves = [];
        let dirs = (p > 2) ? [[-1,-1],[-1,1],[1,-1],[1,1]] : (p===1 ? [[-1,-1],[-1,1]] : [[1,-1],[1,1]]);

        dirs.forEach(d => {
            // Oddiy yurish
            let nr = r + d[0], nc = c + d[1];
            if(nr>=0 && nr<8 && nc>=0 && nc<8 && curBoard[nr][nc] === 0) {
                v_moves.push({fr: r, fc: c, tr: nr, tc: nc, cap: false});
            }
            // Zarba berish
            let zr = r + d[0]*2, zc = c + d[1]*2;
            if(zr>=0 && zr<8 && zc>=0 && zc<8 && curBoard[zr][zc] === 0) {
                let mid = curBoard[r+d[0]][c+d[1]];
                if(mid > 0 && mid%2 !== p%2) v_moves.push({fr: r, fc: c, tr: zr, tc: zc, cap: true, mr: r+d[0], mc: c+d[1]});
            }
        });
        return v_moves;
    }

    function doMove(m) {
        if(m.cap) board[m.mr][m.mc] = 0;
        board[m.tr][m.tc] = board[m.fr][m.fc];
        board[m.fr][m.fc] = 0;
        if(m.tr === 0 && board[m.tr][m.tc] === 1) board[m.tr][m.tc] = 3;
        if(m.tr === 7 && board[m.tr][m.tc] === 2) board[m.tr][m.tc] = 4;

        selected = null; moves = [];
        currentPlayer = (currentPlayer === 1) ? 2 : 1;
        document.getElementById('status').innerText = currentPlayer === 2 ? "âš« Bot o'ylamoqda..." : "âšª Sizning navbatingiz";
        render();
        if(currentPlayer === 2) setTimeout(aiPlay, 800);
    }

    function aiPlay() {
        let all = [];
        for(let r=0; r<8; r++) {
            for(let c=0; c<8; c++) {
                if(board[r][c] === 2 || board[r][c] === 4) {
                    all.push(...getValidMoves(r, c, board));
                }
            }
        }
        if(all.length > 0) {
            let caps = all.filter(m => m.cap);
            let move = caps.length > 0 ? caps[0] : all[Math.floor(Math.random()*all.length)];
            doMove(move);
        } else {
            document.getElementById('status').innerText = "ðŸŽ‰ Siz yutdingiz!";
        }
    }

    function exitGame() { tg.close(); }
    render();
</script>
</body>
</html>