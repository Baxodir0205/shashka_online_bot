<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shashka Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        body {
            background: linear-gradient(145deg, #1a4731, #0a2a1a);
            font-family: 'Segoe UI', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 10px;
        }
        .game-container {
            max-width: 100%;
            width: 100%;
            max-width: 400px;
            background: #2c3e50;
            border-radius: 25px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .header {
            text-align: center;
            color: #ffd700;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 12px;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
        }
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }
        .tab {
            flex: 1;
            padding: 10px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }
        .tab.active {
            background: #3498db;
        }
        .players {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #34495e;
            padding: 12px;
            border-radius: 15px;
            margin-bottom: 15px;
            color: white;
        }
        .player-card {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .avatar {
            width: 40px;
            height: 40px;
            background: #3498db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            position: relative;
        }
        .online-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 10px;
            height: 10px;
            background: #2ecc71;
            border-radius: 50%;
            border: 2px solid #2c3e50;
        }
        .offline-indicator {
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 10px;
            height: 10px;
            background: #95a5a6;
            border-radius: 50%;
            border: 2px solid #2c3e50;
        }
        .player-info {
            display: flex;
            flex-direction: column;
        }
        .player-name {
            font-weight: bold;
            font-size: 14px;
        }
        .player-rating {
            font-size: 12px;
            color: #f1c40f;
        }
        .vs {
            background: #e74c3c;
            padding: 5px 15px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 14px;
        }
        .ai-level-selector {
            background: #34495e;
            padding: 10px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .ai-level-selector label {
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        .ai-level-selector select {
            flex: 1;
            padding: 8px;
            border-radius: 8px;
            border: none;
            background: #2c3e50;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        .board-container {
            background: #8b5a2b;
            padding: 12px;
            border-radius: 15px;
            margin-bottom: 15px;
        }
        .coordinates {
            display: flex;
            justify-content: space-around;
            color: #ffd700;
            font-weight: bold;
            font-size: 14px;
            padding: 5px 0;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 1px;
            background: #594735;
            padding: 1px;
            border-radius: 8px;
        }
        .cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
        }
        .dark { background: #8b5a2b; }
        .light { background: #f0d9b5; }
        .white-piece { color: white; text-shadow: 1px 1px 2px black; }
        .black-piece { color: #2c3e50; text-shadow: 1px 1px 2px white; }
        .king-piece { font-size: 32px; }
        .selected { box-shadow: inset 0 0 0 3px gold; }
        .possible-move { box-shadow: inset 0 0 0 3px #27ae60; }
        .capture-move { box-shadow: inset 0 0 0 3px #e74c3c; }
        .status {
            background: #34495e;
            color: white;
            padding: 12px;
            border-radius: 30px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        /* Foydalanuvchilar bo'limi */
        .users-section {
            background: #34495e;
            border-radius: 15px;
            padding: 15px;
            color: white;
        }
        .users-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .users-header h3 {
            color: #ffd700;
            font-size: 18px;
        }
        .online-count {
            background: #27ae60;
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 12px;
        }
        .search-box {
            margin-bottom: 12px;
        }
        .search-box input {
            width: 100%;
            padding: 10px;
            border-radius: 30px;
            border: none;
            background: #2c3e50;
            color: white;
            font-size: 14px;
        }
        .users-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }
        .user-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #2c3e50;
            padding: 10px;
            border-radius: 12px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            background: #3498db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            position: relative;
        }
        .user-details {
            display: flex;
            flex-direction: column;
        }
        .user-name {
            font-weight: bold;
            font-size: 14px;
        }
        .user-status {
            font-size: 12px;
        }
        .user-status.online { color: #2ecc71; }
        .user-status.offline { color: #95a5a6; }
        .user-rating {
            font-size: 11px;
            color: #f1c40f;
        }
        .invite-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
        }
        .invite-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        .buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            padding: 12px;
            border: none;
            border-radius: 30px;
            font-size: 14px;
            font-weight: bold;
            color: white;
            cursor: pointer;
        }
        .btn-red { background: #e74c3c; }
        .btn-blue { background: #3498db; }
        .btn-green { background: #27ae60; }
        .footer {
            text-align: center;
            margin-top: 15px;
            color: #95a5a6;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">üéØ SHAHKA ONLINE</div>

        <!-- Tablar -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('game')">üéÆ O'YIN</button>
            <button class="tab" onclick="showTab('users')">üë• FOYDALANUVCHILAR</button>
        </div>

        <!-- O'YIN BO'LIMI -->
        <div id="game-section">
            <div class="players">
                <div class="player-card">
                    <div class="avatar">üë§</div>
                    <div class="player-info">
                        <span class="player-name">Siz</span>
                        <span class="player-rating">‚≠ê 1240</span>
                    </div>
                </div>
                <div class="vs">VS</div>
                <div class="player-card" id="opponent-card">
                    <div class="avatar" id="opponent-avatar">ü§ñ</div>
                    <div class="player-info">
                        <span class="player-name" id="opponent-name">AI Bot</span>
                        <span class="player-rating" id="opponent-level">‚ö° Daraja 3</span>
                    </div>
                </div>
            </div>

            <!-- AI DARAJASI -->
            <div class="ai-level-selector" id="ai-selector">
                <label>ü§ñ AI:</label>
                <select id="ai-level" onchange="changeAIDifficulty()">
                    <option value="1">‚≠ê Boshlang'ich</option>
                    <option value="2">‚≠ê‚≠ê O'rta</option>
                    <option value="3" selected>‚≠ê‚≠ê‚≠ê Tajribali</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Mutaxassis</option>
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Usta</option>
                </select>
            </div>

            <!-- DOSKA -->
            <div class="board-container">
                <div class="coordinates">
                    <span></span><span>A</span><span>B</span><span>C</span><span>D</span>
                    <span>E</span><span>F</span><span>G</span><span>H</span><span></span>
                </div>
                <div id="board" class="board"></div>
                <div class="coordinates">
                    <span>8</span><span>7</span><span>6</span><span>5</span>
                    <span>4</span><span>3</span><span>2</span><span>1</span>
                </div>
            </div>

            <div id="status" class="status">‚ö™ Sizning navbatingiz</div>

            <div class="buttons">
                <button class="btn btn-red" onclick="exitGame()">üö™ O'yindan chiqish</button>
                <button class="btn btn-blue" onclick="showTab('users')">üë• Do'stni taklif qilish</button>
            </div>
        </div>

        <!-- FOYDALANUVCHILAR BO'LIMI -->
        <div id="users-section" style="display: none;">
            <div class="users-section">
                <div class="users-header">
                    <h3>üë• Bot a'zolari</h3>
                    <span class="online-count" id="online-count">0 online</span>
                </div>

                <div class="search-box">
                    <input type="text" id="search-users" placeholder="üîç Qidirish..." onkeyup="searchUsers()">
                </div>

                <div class="users-list" id="users-list"></div>

                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-blue" style="flex:1" onclick="loadUsers()">üîÑ Yangilash</button>
                    <button class="btn btn-green" style="flex:1" onclick="playWithAI()">ü§ñ AI bilan o'ynash</button>
                </div>
            </div>
        </div>

        <div class="footer">
            @shashka_gamebot ‚Ä¢ v5.0
        </div>
    </div>

    <script>
        // Shashka doskasi
        let board = [
            [0,2,0,2,0,2,0,2],
            [2,0,2,0,2,0,2,0],
            [0,2,0,2,0,2,0,2],
            [0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0],
            [1,0,1,0,1,0,1,0],
            [0,1,0,1,0,1,0,1],
            [1,0,1,0,1,0,1,0]
        ];

        let currentPlayer = 1;
        let selectedRow = -1, selectedCol = -1;
        let possibleMoves = [];
        let gameOver = false;
        let mustCapture = false;
        let capturePositions = [];
        let gameMode = 'ai';
        let currentOpponent = null;
        let aiDifficulty = 3;

        // Foydalanuvchilar
        let users = [
            { id: 1, name: 'Ali', status: 'online', rating: 1450, avatar: 'üë®' },
            { id: 2, name: 'Vali', status: 'online', rating: 1320, avatar: 'üë¶' },
            { id: 3, name: 'Sobir', status: 'offline', rating: 1180, avatar: 'üë®' },
            { id: 4, name: 'Jalil', status: 'online', rating: 1560, avatar: 'üë®' },
            { id: 5, name: 'Karim', status: 'online', rating: 1240, avatar: 'üë¶' }
        ];

        // Doskani ko'rsatish
        function renderBoard() {
            let html = '';
            for(let row = 0; row < 8; row++) {
                for(let col = 0; col < 8; col++) {
                    let cellClass = (row + col) % 2 === 0 ? 'light' : 'dark';
                    let piece = board[row][col];
                    let symbol = '';
                    let pieceClass = '';

                    if(piece === 1) { symbol = '‚ö™'; pieceClass = 'white-piece'; }
                    if(piece === 2) { symbol = '‚ö´'; pieceClass = 'black-piece'; }
                    if(piece === 3) { symbol = 'üëë‚ö™'; pieceClass = 'white-piece king-piece'; }
                    if(piece === 4) { symbol = 'üëë‚ö´'; pieceClass = 'black-piece king-piece'; }

                    let selectedClass = (selectedRow === row && selectedCol === col) ? 'selected' : '';

                    let moveClass = '';
                    if (possibleMoves.some(m => m.row === row && m.col === col)) {
                        moveClass = possibleMoves.find(m => m.row === row && m.col === col).capture ? 'capture-move' : 'possible-move';
                    }

                    html += `<div class="cell ${cellClass} ${pieceClass} ${selectedClass} ${moveClass}"
                            onclick="cellClick(${row}, ${col})">${symbol}</div>`;
                }
            }
            document.getElementById('board').innerHTML = html;
        }

        function cellClick(row, col) {
            if(gameOver) return;

            if (selectedRow === -1) {
                if ((currentPlayer === 1 && (board[row][col] === 1 || board[row][col] === 3))) {
                    selectedRow = row;
                    selectedCol = col;
                    possibleMoves = getValidMoves(row, col);
                    renderBoard();
                }
            } else {
                let move = possibleMoves.find(m => m.row === row && m.col === col);
                if (move) {
                    makeMove(selectedRow, selectedCol, row, col, move.capture);
                    selectedRow = -1;
                    selectedCol = -1;
                    possibleMoves = [];

                    currentPlayer = 2;
                    document.getElementById('status').innerHTML = 'ü§ñ AI o\'ylamoqda...';
                    renderBoard();
                    checkWinner();

                    if (!gameOver) {
                        setTimeout(aiMove, 500);
                    }
                }
            }
        }

        function getValidMoves(row, col) {
            let moves = [];
            let piece = board[row][col];
            let directions = [[-1,-1], [-1,1]];

            for (let dir of directions) {
                let newRow = row + dir[0];
                let newCol = col + dir[1];
                if (newRow >= 0 && newRow < 8 && newCol >= 0 && newCol < 8 && board[newRow][newCol] === 0) {
                    moves.push({row: newRow, col: newCol, capture: false});
                }

                let captureRow = row + dir[0] * 2;
                let captureCol = col + dir[1] * 2;
                let midRow = row + dir[0];
                let midCol = col + dir[1];

                if (captureRow >= 0 && captureRow < 8 && captureCol >= 0 && captureCol < 8 &&
                    board[captureRow][captureCol] === 0 && board[midRow][midCol] !== 0) {
                    moves.push({row: captureRow, col: captureCol, capture: true});
                }
            }
            return moves;
        }

        function makeMove(fromRow, fromCol, toRow, toCol, isCapture) {
            let piece = board[fromRow][fromCol];

            if (isCapture) {
                let midRow = (fromRow + toRow) / 2;
                let midCol = (fromCol + toCol) / 2;
                board[midRow][midCol] = 0;
            }

            board[toRow][toCol] = piece;
            board[fromRow][fromCol] = 0;

            if (piece === 1 && toRow === 0) {
                board[toRow][toCol] = 3;
            }
        }

        function aiMove() {
            if (gameOver) return;

            let moved = false;
            for(let row = 0; row < 8; row++) {
                for(let col = 0; col < 8; col++) {
                    if(board[row][col] === 2) {
                        if(row < 7 && col > 0 && board[row+1][col-1] === 0) {
                            board[row+1][col-1] = 2;
                            board[row][col] = 0;
                            moved = true;
                            break;
                        }
                        if(row < 7 && col < 7 && board[row+1][col+1] === 0) {
                            board[row+1][col+1] = 2;
                            board[row][col] = 0;
                            moved = true;
                            break;
                        }
                    }
                }
                if(moved) break;
            }

            currentPlayer = 1;
            document.getElementById('status').innerHTML = '‚ö™ Sizning navbatingiz';
            renderBoard();
            checkWinner();
        }

        function checkWinner() {
            let white = 0, black = 0;
            for(let row = 0; row < 8; row++) {
                for(let col = 0; col < 8; col++) {
                    if(board[row][col] === 1 || board[row][col] === 3) white++;
                    if(board[row][col] === 2 || board[row][col] === 4) black++;
                }
            }

            if(white === 0) {
                gameOver = true;
                document.getElementById('status').innerHTML = 'ü§ñ AI yutdi!';
            }
            if(black === 0) {
                gameOver = true;
                document.getElementById('status').innerHTML = 'üéâ Siz yutdingiz!';
            }
        }

        // Foydalanuvchilar
        function loadUsers() {
            const onlineCount = users.filter(u => u.status === 'online').length;
            document.getElementById('online-count').innerHTML = `${onlineCount} online / ${users.length} ta`;

            let html = '';
            users.forEach(user => {
                html += `
                    <div class="user-item">
                        <div class="user-info">
                            <div class="user-avatar">
                                ${user.avatar}
                                ${user.status === 'online' ?
                                    '<span class="online-indicator"></span>' :
                                    '<span class="offline-indicator"></span>'}
                            </div>
                            <div class="user-details">
                                <div class="user-name">${user.name}</div>
                                <div class="user-status ${user.status}">
                                    ${user.status === 'online' ? 'üü¢ Online' : '‚ö´ Offline'}
                                    <span class="user-rating">‚≠ê ${user.rating}</span>
                                </div>
                            </div>
                        </div>
                        <button class="invite-btn" ${user.status === 'offline' ? 'disabled' : ''}>
                            üéÆ Taklif
                        </button>
                    </div>
                `;
            });
            document.getElementById('users-list').innerHTML = html;
        }

        function searchUsers() {
            loadUsers();
        }

        function showTab(tab) {
            document.getElementById('game-section').style.display = tab === 'game' ? 'block' : 'none';
            document.getElementById('users-section').style.display = tab === 'users' ? 'block' : 'none';

            document.querySelectorAll('.tab')[0].classList.toggle('active', tab === 'game');
            document.querySelectorAll('.tab')[1].classList.toggle('active', tab === 'users');

            if (tab === 'users') loadUsers();
        }

        function changeAIDifficulty() {
            aiDifficulty = document.getElementById('ai-level').value;
            const levels = ['‚≠ê Boshlang\'ich', '‚≠ê‚≠ê O\'rta', '‚≠ê‚≠ê‚≠ê Tajribali', '‚≠ê‚≠ê‚≠ê‚≠ê Mutaxassis', '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Usta'];
            document.getElementById('opponent-level').innerHTML = levels[aiDifficulty - 1];
        }

        function playWithAI() {
            gameMode = 'ai';
            document.getElementById('opponent-name').innerHTML = 'AI Bot';
            document.getElementById('opponent-avatar').innerHTML = 'ü§ñ';
            document.getElementById('ai-selector').style.display = 'flex';
            showTab('game');
            newGame();
        }

        function newGame() {
            board = [
                [0,2,0,2,0,2,0,2],
                [2,0,2,0,2,0,2,0],
                [0,2,0,2,0,2,0,2],
                [0,0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0,0],
                [1,0,1,0,1,0,1,0],
                [0,1,0,1,0,1,0,1],
                [1,0,1,0,1,0,1,0]
            ];
            currentPlayer = 1;
            selectedRow = -1;
            selectedCol = -1;
            possibleMoves = [];
            gameOver = false;
            document.getElementById('status').innerHTML = '‚ö™ Sizning navbatingiz';
            renderBoard();
        }

        function exitGame() {
            if (window.Telegram?.WebApp) {
                window.Telegram.WebApp.close();
            } else {
                alert('O\'yindan chiqish');
            }
        }

        // Boshlash
        renderBoard();
        loadUsers();
    </script>
</body>
